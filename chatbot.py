import os
from dotenv import load_dotenv
import google.generativeai as genai
from datetime import datetime

# .env νμΌμ—μ„ ν™κ²½ λ³€μ λ¶λ¬μ¤κΈ°
load_dotenv(dotenv_path='fire.env')

# ν™κ²½ λ³€μμ—μ„ API ν‚¤ κ°€μ Έμ¤κΈ° (μ΄μ „ μ½”λ“μ™€ λ™μΌ)
api_key = os.environ.get("GEMINI_API_KEY")

# API ν‚¤ ν™κ²½λ³€μ μ¤λ¥ λ°μƒ μ‹
if not api_key:
    print("μ¤λ¥: GEMINI_API_KEY ν™κ²½ λ³€μκ°€ μ„¤μ •λμ§€ μ•μ•μµλ‹λ‹¤.")
    exit()
    
# Gemini APIμ— API ν‚¤ μ„¤μ •
genai.configure(api_key=api_key)

# Gemini λ¨λΈ 'gemini-2.5-flash' μ‚¬μ©
model = genai.GenerativeModel('gemini-2.5-flash')

# μΌλ‹¨ λ³€μλ΅ λ§λ“¤μ–΄μ„ μ¶λ ¥ν•΄λ³΄μ
JEONSE_CHECKLIST = """
[μ „μ„Έ κ³„μ•½ μ „ ν•„μ ν™•μΈ μ²΄ν¬λ¦¬μ¤νΈ] π“ 

μ•μ „ν• κ³„μ•½μ„ μ„ν•΄ μ•„λ μ‚¬ν•­λ“¤μ„ λ°λ“μ‹ ν™•μΈν•κ³  μ§„ν–‰ν•μ„Έμ”!

## 1. μ„λ¥ ν™•μΈ (κ°€μ¥ μ¤‘μ”!)
- **λ“±κΈ°λ¶€λ“±λ³Έ** : κ³„μ•½ν•λ ¤λ” μ§‘μ μ‹ λ¶„μ¦μ…λ‹λ‹¤. (μ „μ…μ„Έλ€ μ—΄λ μ „ ν™•μΈ ν•„μ!!) 'κ°‘κµ¬'μ—μ„ μ‹¤μ  μ†μ μ£Όκ°€ λ„κµ¬μΈμ§€, 'μ„κµ¬'μ—μ„ κ·Όμ €λ‹Ήκ¶(λΉ), κ°€μ••λ¥ λ“± μ„ν— μ”μ†κ°€ μλ”μ§€ κΌ­ ν™•μΈν•μ„Έμ”.
- **κ±΄μ¶•λ¬Όλ€μ¥** : κ±΄λ¬Όμ μ‹¤μ  μ©λ„μ™€ μΌμΉ μ—¬λ¶€λ¥Ό ν™•μΈν•©λ‹λ‹¤. λ¶λ²• κ±΄μ¶•λ¬Όμ€ μ•„λ‹μ§€, κ³„μ•½ν•λ ¤λ” νΈμμ μ©λ„κ°€ 'μ£Όκ±°μ©'μΌλ΅ λμ–΄ μλ”μ§€ ν™•μΈν•μ„Έμ”. (κ·Όλ¦°μƒν™μ‹μ„¤μ„ λ¶λ²• κ°μ΅°ν• κ²½μ° λ³΄μ¦λ³΄ν— κ°€μ…μ΄ κ±°μ λ  μ μμµλ‹λ‹¤.)
- **μ§‘μ£ΌμΈ μ‹ λ¶„μ¦** : λ“±κΈ°λ¶€λ“±λ³Έ μƒμ μ†μ μ£Όμ™€ κ³„μ•½ λ‹Ήμ‚¬μκ°€ λ™μΌμΈλ¬ΌμΈμ§€ μ‹ λ¶„μ¦μΌλ΅ λ€μ΅° ν™•μΈν•΄μ•Ό ν•©λ‹λ‹¤.

## 2. κ¶λ¦¬ κ΄€κ³„ ν™•μΈ
- **μ„ μμ„ κ¶λ¦¬ ν™•μΈ** : λ‚λ³΄λ‹¤ λ¨Όμ € λμ„ λ°›μ„ κ¶λ¦¬(κ·Όμ €λ‹Ή λ“±)κ°€ μλ”μ§€, μλ‹¤λ©΄ κ·Έ κΈμ•΅μ΄ μ§‘κ°’μ— λΉ„ν•΄ λ„λ¬΄ λ†’μ§€ μ•μ€μ§€ ν™•μΈν•΄μ•Ό ν•©λ‹λ‹¤. (μ§‘κ°’μ 70%λ¥Ό λ„μΌλ©΄ μ„ν— μ‹ νΈ!)
- **λ€λ¦¬μΈ κ³„μ•½ μ‹** : μ§‘μ£ΌμΈμ΄ μ•„λ‹ λ€λ¦¬μΈκ³Ό κ³„μ•½ μ‹, μ§‘μ£ΌμΈμ μΈκ°μ¦λ…μ„κ°€ μ²¨λ¶€λ μ„μ„μ¥μ„ λ°λ“μ‹ 'μ›λ³Έ'μΌλ΅ λ°›μ•„μ•Ό ν•©λ‹λ‹¤. (μμƒ ν†µν™”λ΅ μ§‘μ£ΌμΈ λ³ΈμΈ μμ‚¬ ν™•μΈ μ¶”μ²)

## 3. λ³΄μ¦κΈ λ³΄νΈ
- **μ „μ„Έλ³΄μ¦κΈ λ°ν™ λ³΄ν— κ°€μ… κ°€λ¥ μ—¬λ¶€**: κ³„μ•½ μ „μ— ν•΄λ‹Ή μ£Όνƒμ΄ HUG μ£Όνƒλ„μ‹λ³΄μ¦κ³µμ‚¬λ‚ SGIμ„μΈλ³΄μ¦λ³΄ν—μ λ³΄μ¦λ³΄ν—μ— κ°€μ… κ°€λ¥ν• λ§¤λ¬ΌμΈμ§€ λ―Έλ¦¬ ν™•μΈν•΄λ³΄λ” κ²ƒμ΄ κ°€μ¥ μ•μ „ν•©λ‹λ‹¤.

κ¶κΈν• μ„λ¥ μ΄λ¦„μ΄λ‚ ν™•μΈ λ°©λ²•μ— λ€ν•΄ μ§λ¬Έν•΄μ£Όμ‹λ©΄ λ” μμ„Έν μ•λ ¤λ“λ¦΄κ²μ”!
"""

# chat_with_gemini ν•¨μ
# μ‚¬μ©μ μ…λ ¥(user_input)μ„ λ°›μ•„ Gemini λ¨λΈκ³Ό ν†µμ‹ ν•κ³  μ‘λ‹µμ„ λ°ν™ν•λ” ν•¨μ
# Gemini νΈμ¶ κ³Όμ •μ—μ„ λ°μƒν•  μ μλ” μ¤λ¥λ¥Ό try-except κµ¬λ¬ΈμΌλ΅ μ¤λ¥λ¥Ό μ²λ¦¬ν•¨
def chat_with_gemini(user_input):
    try:
        response = model.generate_content(user_input) 
        return response.text
    except Exception as e:
        return f"μ¤λ¥: API νΈμ¶ μ¤‘ λ¬Έμ κ°€ λ°μƒν–μµλ‹λ‹¤. ({e})"
    
log_file_path = "chat_log.txt"

# __name__ λ³€μ: ν„μ¬ μ‹¤ν–‰λκ³  μλ” νμ΄μ¬ μ¤ν¬λ¦½νΈμ μ΄λ¦„μ„ λ‹΄λ” λ³€μ
# μ¤ν¬λ¦½νΈκ°€ μ§μ ‘ μ‹¤ν–‰λ  λ• νμ΄μ¬μ€ __name__ λ³€μμ— __main__ μ΄λΌλ” κ°’μ„ ν• λ‹Ήν•¨
# test.py μ‹¤ν–‰λλ©΄ Gemini μ‹μ‘ λ©”μ‹μ§€λ¥Ό μ¶λ ¥ν•λ” κΈ°λ¥

def chat_with_gemini(user_input):
    """Gemini λ¨λΈκ³Ό ν†µμ‹ ν•΄ μ‘λ‹µ λ°ν™"""
    try:
        response = model.generate_content(user_input)
        return response.text
    except Exception as e:
        return f"μ¤λ¥: API νΈμ¶ μ¤‘ λ¬Έμ κ°€ λ°μƒν–μµλ‹λ‹¤. ({e})"

